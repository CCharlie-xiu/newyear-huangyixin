<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å›å¿†å®¶å®´ - 2025</title>
    <style>
        :root {
            --bg: #FAF8F5;
            --bg-dark: #F0EDE8;
            --accent: #E8836B;
            --accent-light: #FCEAE6;
            --gold: #C9A96E;
            --text: #1A1A1A;
            --text-sub: #888888;
            --text-light: #BBBBBB;
            --white: #FFFFFF;
            --shadow: rgba(0,0,0,0.08);
            --radius: 16px;
        }

        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        html { scroll-behavior: smooth; }

        body {
            background: var(--bg);
            font-family: -apple-system, "PingFang SC", "Helvetica Neue", sans-serif;
            color: var(--text);
            overflow: hidden;
            -webkit-overflow-scrolling: touch;
        }

        body.scrollable {
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* ===== Section é€šç”¨ ===== */
        .section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 60px 24px;
            position: relative;
        }

        /* ===== Intro å¼•å¯¼å±‚ ===== */
        #intro {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.55);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.6s ease, visibility 0.6s ease;
        }
        #intro.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        .intro-card {
            background: var(--white);
            border-radius: 28px;
            padding: 40px 32px;
            text-align: center;
            width: 85%;
            max-width: 320px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.25);
            transform: scale(1);
            transition: transform 0.4s ease;
        }
        #intro.hidden .intro-card { transform: scale(0.9); }
        .intro-icon {
            font-size: 48px;
            display: block;
            margin-bottom: 16px;
            animation: heartbeat 1.2s ease-in-out infinite;
        }
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        .intro-card h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .intro-card p {
            font-size: 14px;
            color: var(--text-sub);
            margin-bottom: 28px;
            line-height: 1.6;
        }
        .btn-start {
            background: var(--accent);
            color: var(--white);
            border: none;
            padding: 14px 0;
            border-radius: 14px;
            width: 100%;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            letter-spacing: 2px;
        }
        .btn-start:active {
            transform: scale(0.97);
            box-shadow: 0 4px 16px rgba(232,131,107,0.4);
        }

        /* ===== Cover å°é¢ ===== */
        #cover {
            min-height: 100vh;
            background: linear-gradient(180deg, var(--bg) 0%, var(--accent-light) 100%);
            text-align: center;
        }
        .cover-year {
            font-size: 96px;
            font-weight: 800;
            color: var(--accent);
            line-height: 1;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease;
        }
        .cover-year.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .cover-title {
            font-size: 22px;
            font-weight: 600;
            margin-top: 12px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s ease 0.2s;
        }
        .cover-title.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .cover-sub {
            font-size: 14px;
            color: var(--text-sub);
            margin-top: 8px;
            opacity: 0;
            transition: opacity 0.8s ease 0.4s;
        }
        .cover-sub.visible { opacity: 1; }
        .scroll-hint {
            position: absolute;
            bottom: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            opacity: 0;
            animation: fadeInUp 1s ease 1s forwards;
        }
        .scroll-hint span {
            font-size: 12px;
            color: var(--text-light);
            letter-spacing: 2px;
        }
        .scroll-arrow {
            width: 20px;
            height: 20px;
            border-right: 2px solid var(--text-light);
            border-bottom: 2px solid var(--text-light);
            transform: rotate(45deg);
            animation: bounce 1.5s ease infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: rotate(45deg) translateY(0); }
            50% { transform: rotate(45deg) translateY(6px); }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== Timeline æ—¶é—´é”šç‚¹ ===== */
        #timeline {
            min-height: auto;
            padding: 80px 24px;
            background: var(--bg);
        }
        .timeline-header {
            text-align: center;
            margin-bottom: 48px;
        }
        .timeline-header h2 {
            font-size: 24px;
            font-weight: 700;
        }
        .timeline-header p {
            font-size: 13px;
            color: var(--text-sub);
            margin-top: 6px;
        }
        .timeline-track {
            position: relative;
            padding-left: 28px;
            max-width: 400px;
            margin: 0 auto;
        }
        .timeline-track::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--bg-dark);
        }
        .timeline-node {
            position: relative;
            margin-bottom: 36px;
            opacity: 0;
            transform: translateX(-16px);
            transition: all 0.5s ease;
        }
        .timeline-node.visible {
            opacity: 1;
            transform: translateX(0);
        }
        .timeline-node::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 6px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--bg-dark);
            border: 2px solid var(--white);
            transition: background 0.3s;
        }
        .timeline-node.visible::before {
            background: var(--accent);
        }
        .timeline-node h3 {
            font-size: 16px;
            font-weight: 600;
        }
        .timeline-node p {
            font-size: 13px;
            color: var(--text-sub);
            margin-top: 4px;
            line-height: 1.5;
        }

        /* ===== Memories å›å¿†ä¸»ä½“ ===== */
        #memories {
            min-height: auto;
            padding: 60px 16px;
            background: var(--bg);
        }
        .memories-header {
            text-align: center;
            margin-bottom: 32px;
            padding: 0 8px;
        }
        .memories-header h2 { font-size: 24px; font-weight: 700; }
        .memories-header p { font-size: 13px; color: var(--text-sub); margin-top: 6px; }
        .waterfall {
            column-count: 2;
            column-gap: 12px;
            max-width: 500px;
            margin: 0 auto;
        }
        .photo-card {
            break-inside: avoid;
            margin-bottom: 12px;
            border-radius: var(--radius);
            overflow: hidden;
            background: var(--white);
            box-shadow: 0 4px 12px var(--shadow);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        .photo-card.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .photo-card img {
            width: 100%;
            display: block;
            object-fit: cover;
        }
        .photo-card .caption {
            padding: 10px 12px;
            font-size: 12px;
            color: var(--text-sub);
            line-height: 1.5;
        }

        /* ===== Highlight é«˜å…‰æ—¶åˆ» ===== */
        #highlight {
            min-height: 100vh;
            background: linear-gradient(180deg, var(--bg) 0%, #FFF5F0 50%, var(--bg) 100%);
            text-align: center;
        }
        .highlight-badge {
            display: inline-block;
            background: var(--accent);
            color: var(--white);
            font-size: 12px;
            font-weight: 600;
            padding: 6px 16px;
            border-radius: 20px;
            letter-spacing: 2px;
            margin-bottom: 20px;
            opacity: 0;
            transition: opacity 0.6s ease;
        }
        .highlight-badge.visible { opacity: 1; }
        .highlight-img {
            width: 90%;
            max-width: 360px;
            border-radius: 20px;
            box-shadow: 0 16px 48px rgba(232,131,107,0.2);
            opacity: 0;
            transform: scale(0.95);
            transition: all 0.8s ease 0.2s;
        }
        .highlight-img.visible {
            opacity: 1;
            transform: scale(1);
        }
        .highlight-text {
            font-size: 18px;
            font-weight: 600;
            margin-top: 24px;
            opacity: 0;
            transition: opacity 0.6s ease 0.4s;
        }
        .highlight-text.visible { opacity: 1; }
        .highlight-sub {
            font-size: 13px;
            color: var(--text-sub);
            margin-top: 8px;
            opacity: 0;
            transition: opacity 0.6s ease 0.6s;
        }
        .highlight-sub.visible { opacity: 1; }

        /* ===== Pause å‡é€ŸåŒº ===== */
        #pause {
            min-height: 80vh;
            background: var(--bg);
            text-align: center;
        }
        .pause-line {
            width: 1px;
            height: 80px;
            background: var(--text-light);
            margin: 0 auto 32px;
            opacity: 0;
            transition: opacity 1s ease;
        }
        .pause-line.visible { opacity: 1; }
        .pause-text {
            font-size: 16px;
            color: var(--text-sub);
            line-height: 2;
            opacity: 0;
            transition: opacity 1s ease 0.3s;
        }
        .pause-text.visible { opacity: 1; }

        /* ===== Ending ç»“æŸåŒº ===== */
        #ending {
            min-height: 100vh;
            background: linear-gradient(180deg, var(--bg) 0%, var(--accent-light) 100%);
            text-align: center;
        }
        .ending-year {
            font-size: 64px;
            font-weight: 800;
            color: var(--accent);
            opacity: 0;
            transition: all 0.8s ease;
        }
        .ending-year.visible { opacity: 1; }
        .ending-msg {
            font-size: 18px;
            font-weight: 600;
            margin-top: 12px;
            opacity: 0;
            transition: opacity 0.8s ease 0.2s;
        }
        .ending-msg.visible { opacity: 1; }
        .ending-sub {
            font-size: 13px;
            color: var(--text-sub);
            margin-top: 8px;
            line-height: 1.8;
            opacity: 0;
            transition: opacity 0.8s ease 0.4s;
        }
        .ending-sub.visible { opacity: 1; }
        .ending-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 40px;
            width: 80%;
            max-width: 260px;
            opacity: 0;
            transition: opacity 0.8s ease 0.6s;
        }
        .ending-actions.visible { opacity: 1; }
        .btn-action {
            padding: 14px 0;
            border-radius: 14px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: transform 0.2s;
            letter-spacing: 1px;
        }
        .btn-action:active { transform: scale(0.97); }
        .btn-primary {
            background: var(--accent);
            color: var(--white);
        }
        .btn-secondary {
            background: var(--white);
            color: var(--text);
            border: 1px solid var(--bg-dark);
        }

        /* ===== æµ®çª—è§†é¢‘ ===== */
        #video-float {
            position: fixed;
            top: 16px; right: 16px;
            width: 120px; height: 160px;
            background: #000;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.25);
            z-index: 900;
            border: 2px solid var(--white);
            overflow: hidden;
            touch-action: none;
            cursor: move;
            display: none;
            transition: box-shadow 0.3s;
        }
        #video-float:active {
            box-shadow: 0 12px 32px rgba(0,0,0,0.35);
        }
        #video-float video {
            width: 100%; height: 100%;
            object-fit: cover;
        }
        .video-close {
            position: absolute;
            top: 6px; right: 6px;
            width: 22px; height: 22px;
            background: rgba(0,0,0,0.5);
            border: none;
            border-radius: 50%;
            color: #fff;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ===== è¿›åº¦æŒ‡ç¤ºå™¨ ===== */
        #progress-bar {
            position: fixed;
            top: 0; left: 0;
            height: 3px;
            background: var(--accent);
            z-index: 800;
            width: 0%;
            transition: width 0.1s linear;
        }

        /* ===== éŸ³é¢‘æ§åˆ¶ ===== */
        #audio-btn {
            position: fixed;
            top: 16px; left: 16px;
            width: 36px; height: 36px;
            border-radius: 50%;
            background: var(--white);
            border: none;
            box-shadow: 0 2px 12px var(--shadow);
            z-index: 800;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        /* ===== å·¥å…·ç±» ===== */
        .fade-section > * {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }
        .fade-section > .visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <!-- è¿›åº¦æ¡ -->
    <div id="progress-bar"></div>

    <!-- éŸ³é¢‘æ§åˆ¶æŒ‰é’® -->
    <button id="audio-btn" onclick="toggleAudio()">ğŸµ</button>
    <audio id="bgm" loop preload="auto">
        <source src="your-music.mp3" type="audio/mpeg">
    </audio>

    <!-- æµ®çª—è§†é¢‘ -->
    <div id="video-float">
        <video autoplay muted loop playsinline>
            <source src="your-video.mp4" type="video/mp4">
        </video>
        <button class="video-close" onclick="closeVideo()">âœ•</button>
    </div>

    <!-- Section 0: Intro å¼•å¯¼å±‚ -->
    <div id="intro">
        <div class="intro-card">
            <span class="intro-icon">â¤ï¸</span>
            <h2>å¼€å¯å›å¿†</h2>
            <p>ä¸€èµ·å›é¡¾å±äºæˆ‘ä»¬çš„ 2025<br>é‚£äº›æ¸©æš–çš„ç¬é—´</p>
            <button class="btn-start" onclick="startMemory()">ç‚¹å‡»å›å¿†</button>
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <main id="main-content">

        <!-- Section 1: Cover å°é¢ -->
        <section id="cover" class="section">
            <div class="cover-year">2025</div>
            <div class="cover-title">å›å¿†å®¶å®´</div>
            <div class="cover-sub">é»„ä¸€å¿ƒ Â· å¹´åº¦å›é¡¾</div>
            <div class="scroll-hint">
                <span>å‘ä¸‹æ»‘åŠ¨</span>
                <div class="scroll-arrow"></div>
            </div>
        </section>

        <!-- Section 2: Timeline æ—¶é—´é”šç‚¹ -->
        <section id="timeline" class="section">
            <div class="timeline-header">
                <h2>æ—¶å…‰è½´</h2>
                <p>é‚£äº›å€¼å¾—è®°ä½çš„æ—¥å­</p>
            </div>
            <div class="timeline-track" id="timeline-track">
                <!-- JS åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </section>

        <!-- Section 3: Memories å›å¿†ä¸»ä½“ -->
        <section id="memories" class="section">
            <div class="memories-header">
                <h2>æ¸©æš–ç¬é—´</h2>
                <p>æ¯ä¸€å¸§éƒ½æ˜¯æ•…äº‹</p>
            </div>
            <div class="waterfall" id="gallery">
                <!-- JS åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </section>

        <!-- Section 4: Highlight é«˜å…‰æ—¶åˆ» -->
        <section id="highlight" class="section">
            <div class="highlight-badge">é«˜å…‰æ—¶åˆ»</div>
            <img class="highlight-img" src="https://picsum.photos/seed/together/600/400" alt="é«˜å…‰æ—¶åˆ»">
            <div class="highlight-text">æœ€çè´µçš„å›¢èš</div>
            <div class="highlight-sub">è¿™ä¸€åˆ»ï¼Œæ‰€æœ‰çš„å¿™ç¢Œéƒ½å€¼å¾—</div>
        </section>

        <!-- Section 5: Pause å‡é€ŸåŒº -->
        <section id="pause" class="section">
            <div class="pause-line"></div>
            <div class="pause-text">
                æ—¶é—´æ…¢ä¸‹æ¥<br>
                è®©æˆ‘ä»¬å¥½å¥½æ„Ÿå—<br>
                è¿™ä¸€å¹´çš„æ¸©åº¦
            </div>
        </section>

        <!-- Section 6: Ending ç»“æŸåŒº -->
        <section id="ending" class="section">
            <div class="ending-year">2025</div>
            <div class="ending-msg">æ„Ÿè°¢è¿™ä¸€å¹´çš„é™ªä¼´</div>
            <div class="ending-sub">
                æ„¿æ–°çš„ä¸€å¹´<br>
                ç»§ç»­æ¸©æš–ç›¸ä¼´
            </div>
            <div class="ending-actions">
                <button class="btn-action btn-primary" onclick="replay()">å†çœ‹ä¸€æ¬¡</button>
                <button class="btn-action btn-secondary" onclick="shareMemory()">åˆ†äº«ç»™æœ‹å‹</button>
            </div>
        </section>

    </main>

<script>
    // ===== çŠ¶æ€æœº =====
    const STAGES = ['intro','cover','timeline','memories','highlight','pause','ending'];
    let currentStage = 'intro';
    let audioPlaying = false;

    // ===== æ•°æ®é…ç½® =====
    const timelineData = [
        { month: 'ä¸€æœˆ', text: 'æ–°å¹´çš„ç¬¬ä¸€é¡¿å®¶å®´' },
        { month: 'ä¸‰æœˆ', text: 'æ˜¥å¤©æ¥äº†ï¼Œä¸€èµ·è¸é’' },
        { month: 'äº”æœˆ', text: 'å¿™ç¢Œä¸­çš„å°èš' },
        { month: 'å…«æœˆ', text: 'ç››å¤çš„å‘³é“' },
        { month: 'åæœˆ', text: 'é‡‘ç§‹å›¢åœ†' },
        { month: 'åäºŒæœˆ', text: 'å¹´æœ«çš„æ¸©æš–æ”¶å°¾' }
    ];

    const imgUrls = [
        'https://picsum.photos/seed/fish/400/500',
        'https://picsum.photos/seed/cook/400/600',
        'https://picsum.photos/seed/family/400/400',
        'https://picsum.photos/seed/dinner/400/550',
        'https://picsum.photos/seed/feast/400/480'
    ];

    const captions = [
        'å¤„ç†é£Ÿæçš„è®¤çœŸæ¨¡æ ·',
        'åˆ€å·¥äº†å¾—',
        'æœ€ç¾å…¨å®¶ç¦',
        'å¤§å¨ä¸Šçº¿',
        'å¼€é¥­å•¦'
    ];

    // ===== æ ¸å¿ƒï¼šå¼€å¯å›å¿† =====
    function startMemory() {
        const intro = document.getElementById('intro');
        intro.classList.add('hidden');
        intro.addEventListener('transitionend', () => {
            intro.style.display = 'none';
        }, { once: true });
        // è®°ä½å·²å¼€å¯ï¼Œä¸‹æ¬¡ä¸å†å¼¹å‡º
        localStorage.setItem('memory_opened', '1');
        document.body.classList.add('scrollable');

        // æ’­æ”¾éŸ³é¢‘
        const bgm = document.getElementById('bgm');
        bgm.play().then(() => {
            audioPlaying = true;
            document.getElementById('audio-btn').style.display = 'flex';
        }).catch(() => {
            document.getElementById('audio-btn').style.display = 'flex';
        });

        // æ˜¾ç¤ºæµ®çª—è§†é¢‘
        document.getElementById('video-float').style.display = 'block';

        // åˆå§‹åŒ–å†…å®¹
        buildTimeline();
        buildGallery();

        // æ¿€æ´»å°é¢åŠ¨ç”»
        setStage('cover');
        setTimeout(() => {
            document.querySelector('.cover-year').classList.add('visible');
            document.querySelector('.cover-title').classList.add('visible');
            document.querySelector('.cover-sub').classList.add('visible');
        }, 100);

        // å¯åŠ¨è§‚å¯Ÿå™¨
        initObservers();
        enableDrag(document.getElementById('video-float'));
    }

    // ===== çŠ¶æ€åˆ‡æ¢ =====
    function setStage(stage) {
        const idx = STAGES.indexOf(stage);
        const curIdx = STAGES.indexOf(currentStage);
        if (idx > curIdx) {
            currentStage = stage;
        }
    }

    // ===== æ„å»ºæ—¶é—´è½´ =====
    function buildTimeline() {
        const track = document.getElementById('timeline-track');
        timelineData.forEach(item => {
            const node = document.createElement('div');
            node.className = 'timeline-node';
            node.innerHTML = `<h3>${item.month}</h3><p>${item.text}</p>`;
            track.appendChild(node);
        });
    }

    // ===== æ„å»ºç€‘å¸ƒæµç›¸å†Œ =====
    function buildGallery() {
        const gallery = document.getElementById('gallery');
        // é¢„è®¾ä¸åŒé«˜åº¦ï¼Œåˆ¶é€ ç€‘å¸ƒæµå‚å·®æ„Ÿ
        const heights = [320, 420, 280, 500, 360, 450, 300, 380, 460, 340];
        for (let i = 0; i < 10; i++) {
            const card = document.createElement('div');
            card.className = 'photo-card';
            const h = heights[i];
            const url = `https://picsum.photos/seed/mem${i}/400/${h}`;
            const cap = captions[i % captions.length];
            card.innerHTML = `<img src="${url}" loading="lazy" alt="${cap}" style="height:${h * 0.5}px;object-fit:cover;"><div class="caption">${cap}</div>`;
            gallery.appendChild(card);
        }
    }

    // ===== IntersectionObserver =====
    function initObservers() {
        // æ—¶é—´è½´èŠ‚ç‚¹è§‚å¯Ÿ
        const timelineObs = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    setStage('timeline');
                }
            });
        }, { threshold: 0.3 });

        document.querySelectorAll('.timeline-node').forEach(node => {
            timelineObs.observe(node);
        });

        // ç…§ç‰‡å¡ç‰‡è§‚å¯Ÿï¼ˆæ‡’åŠ è½½åŠ¨ç”»ï¼‰
        const photoObs = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    setStage('memories');
                }
            });
        }, { threshold: 0.15 });

        document.querySelectorAll('.photo-card').forEach(card => {
            photoObs.observe(card);
        });

        // å„ Section è§‚å¯Ÿï¼ˆçŠ¶æ€æ¨è¿›ï¼‰
        const sectionObs = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.id;
                    setStage(id);
                    // æ¿€æ´»è¯¥ section å†…çš„åŠ¨ç”»å…ƒç´ 
                    entry.target.querySelectorAll(
                        '.highlight-badge,.highlight-img,.highlight-text,.highlight-sub,' +
                        '.pause-line,.pause-text,' +
                        '.ending-year,.ending-msg,.ending-sub,.ending-actions'
                    ).forEach(el => el.classList.add('visible'));
                }
            });
        }, { threshold: 0.3 });

        ['highlight','pause','ending'].forEach(id => {
            const el = document.getElementById(id);
            if (el) sectionObs.observe(el);
        });
    }

    // ===== æ‹–æ‹½æµ®çª— =====
    function enableDrag(el) {
        let startX = 0, startY = 0, elX = 0, elY = 0, dragging = false;

        function onStart(e) {
            e.preventDefault();
            const point = e.touches ? e.touches[0] : e;
            startX = point.clientX;
            startY = point.clientY;
            elX = el.offsetLeft;
            elY = el.offsetTop;
            dragging = true;
            document.addEventListener('mousemove', onMove);
            document.addEventListener('touchmove', onMove, { passive: false });
            document.addEventListener('mouseup', onEnd);
            document.addEventListener('touchend', onEnd);
        }

        function onMove(e) {
            if (!dragging) return;
            e.preventDefault();
            const point = e.touches ? e.touches[0] : e;
            let newLeft = elX + (point.clientX - startX);
            let newTop = elY + (point.clientY - startY);

            // è¾¹ç•Œé™åˆ¶
            const maxLeft = window.innerWidth - el.offsetWidth;
            const maxTop = window.innerHeight - el.offsetHeight;
            newLeft = Math.max(0, Math.min(newLeft, maxLeft));
            newTop = Math.max(0, Math.min(newTop, maxTop));

            el.style.left = newLeft + 'px';
            el.style.top = newTop + 'px';
            el.style.right = 'auto';
        }

        function onEnd() {
            dragging = false;
            document.removeEventListener('mousemove', onMove);
            document.removeEventListener('touchmove', onMove);
            document.removeEventListener('mouseup', onEnd);
            document.removeEventListener('touchend', onEnd);
        }

        el.addEventListener('mousedown', onStart);
        el.addEventListener('touchstart', onStart, { passive: false });
    }

    // ===== éŸ³é¢‘æ§åˆ¶ =====
    function toggleAudio() {
        const bgm = document.getElementById('bgm');
        const btn = document.getElementById('audio-btn');
        if (audioPlaying) {
            bgm.pause();
            btn.textContent = 'ğŸ”‡';
            audioPlaying = false;
        } else {
            bgm.play();
            btn.textContent = 'ğŸµ';
            audioPlaying = true;
        }
    }

    // ===== å…³é—­æµ®çª—è§†é¢‘ =====
    function closeVideo() {
        const vf = document.getElementById('video-float');
        vf.style.display = 'none';
        vf.querySelector('video').pause();
    }

    // ===== æ»šåŠ¨è¿›åº¦æ¡ =====
    function updateProgress() {
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
        const progress = scrollHeight > 0 ? (scrollTop / scrollHeight) * 100 : 0;
        document.getElementById('progress-bar').style.width = progress + '%';
    }

    window.addEventListener('scroll', updateProgress, { passive: true });

    // ===== é¡µé¢åŠ è½½ï¼šæ£€æŸ¥æ˜¯å¦è·³è¿‡å¼¹çª— =====
    if (localStorage.getItem('memory_opened')) {
        document.getElementById('intro').style.display = 'none';
        document.body.classList.add('scrollable');
        document.getElementById('audio-btn').style.display = 'flex';
        document.getElementById('video-float').style.display = 'block';
        buildTimeline();
        buildGallery();
        setStage('cover');
        document.querySelector('.cover-year').classList.add('visible');
        document.querySelector('.cover-title').classList.add('visible');
        document.querySelector('.cover-sub').classList.add('visible');
        initObservers();
        enableDrag(document.getElementById('video-float'));
    }

    // ===== å†çœ‹ä¸€æ¬¡ =====
    function replay() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
        currentStage = 'cover';

        // é‡ç½®æ‰€æœ‰åŠ¨ç”»çŠ¶æ€
        document.querySelectorAll('.visible').forEach(el => {
            if (!el.classList.contains('cover-year') &&
                !el.classList.contains('cover-title') &&
                !el.classList.contains('cover-sub')) {
                el.classList.remove('visible');
            }
        });

        // é‡æ–°è§¦å‘è§‚å¯Ÿå™¨
        setTimeout(() => initObservers(), 800);
    }

    // ===== åˆ†äº« =====
    function shareMemory() {
        if (navigator.share) {
            navigator.share({
                title: 'å›å¿†å®¶å®´ - 2025',
                text: 'ä¸€èµ·å›é¡¾å±äºæˆ‘ä»¬çš„ 2025',
                url: window.location.href
            }).catch(() => {});
        } else {
            // é™çº§ï¼šå¤åˆ¶é“¾æ¥
            const input = document.createElement('input');
            input.value = window.location.href;
            document.body.appendChild(input);
            input.select();
            document.execCommand('copy');
            document.body.removeChild(input);
            showToast('é“¾æ¥å·²å¤åˆ¶');
        }
    }

    // ===== Toast æç¤º =====
    function showToast(msg) {
        const t = document.createElement('div');
        t.textContent = msg;
        Object.assign(t.style, {
            position: 'fixed', bottom: '80px', left: '50%',
            transform: 'translateX(-50%)',
            background: 'rgba(0,0,0,0.7)', color: '#fff',
            padding: '10px 24px', borderRadius: '20px',
            fontSize: '14px', zIndex: '9999',
            transition: 'opacity 0.3s'
        });
        document.body.appendChild(t);
        setTimeout(() => { t.style.opacity = '0'; }, 1500);
        setTimeout(() => { document.body.removeChild(t); }, 1800);
    }
</script>
</body>
</html>
